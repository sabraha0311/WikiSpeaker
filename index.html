<!DOCTYPE html>
<html lang="en">

<html>
<head> 
  <link rel="shortcut icon" href="data:image/x-icon;," type="image/x-icon"> 
 <!-- <title> -->
</head>

<body>
  <main>
    <header class="header">
      <img class="logo" src="https://upload.wikimedia.org/wikipedia/commons/thumb/8/80/Wikipedia-logo-v2.svg/657px-Wikipedia-logo-v2.svg.png" alt="Wikipedia Logo" />

      <form class="search-form js-search-form">
        <input placeholder="Type a keyword and press Enter to search" type="search" class="search-input js-search-input" autofocus />
      </form>
    </header>

    <div class="loading-indicator">
      <div class="sk-chase js-spinner hidden">
        <div class="sk-chase-dot"></div>
        <div class="sk-chase-dot"></div>
        <div class="sk-chase-dot"></div>
        <div class="sk-chase-dot"></div>
        <div class="sk-chase-dot"></div>
        <div class="sk-chase-dot"></div>
      </div>
    </div>
    <section class="wiki js-wiki-article">
      <iframe id="wiki-frame"
      width="800"
      height="600"
      src="">
    </iframe>
    <div id="wiki-article">
      <div id="wiki-title"></div>
      <div id="wiki-content"></div>
    </div>
    </section>
    <section class="search-results js-search-results">
    </section>

    <div class="voiceinator">

    <h1>WikiSpeaker</h1>

    <select name="voice" id="voices">
      <option value="">Select A Voice</option>
    </select>

    <label for="rate">Rate:</label>
    <input name="rate" type="range" min="0" max="3" value="1" step="0.1">

    <label for="pitch">Pitch:</label>
    <input name="pitch" type="range" min="0" max="2" step="0.1">

    <textarea id="textTest" name="text">Hello world!</textarea>

    <button type="button" id="speakButton">Play</button> 
    <button type="button">Stop</button> 

    </div>

    <script>

      const msg = new SpeechSynthesisUtterance();
      let voices = [];
      const voicesDropdown = document.querySelector('[name="voice"]');
      const options = document.querySelectorAll('[type="range"], [name="text"]'); // includes text box
      const speakButton = document.getElementById('speakButton');
      const stopButton = document.querySelector('#stop');
      msg.text = document.querySelector('[name="text"]').value;
      msg.addEventListener('end', textOver);

      function populateVoices() {
        voices = this.getVoices();
        voicesDropdown.innerHTML = voices
        // .filter(voice => voice.lang.eincludes('en')) //only english
        .map(voice => `<option value="${voice.name}">${voice.name} (${voice.lang})</option>`)
          .join('');
      }

      function getVoices() { 
        return window.speechSynthesis.getVoices();
      }

      function setVoice(event) {
        selectedVoice = event.target.selectedOptions[0].value;
        msg.voice = getVoices().find(voice => voice.name === selectedVoice);
      }
      
      function toggle(event, startOver = false) {
        if (startOver) {
          speechSynthesis.cancel();
          speechSynthesis.speak(msg);
          //set button text to "pause"
        } else if (speechSynthesis.speaking && !speechSynthesis.paused) {
          speechSynthesis.pause();  
          //set button text to "play"
        } else if (speechSynthesis.speaking && speechSynthesis.paused) {
          speechSynthesis.resume();
          //set button text to "pause"
        } else {
          speechSynthesis.cancel();
          speechSynthesis.speak(msg);
          //set button text to "pause"
        }
      }

      function textOver(event) { 
        console.log("test");
        //set button text to "play"
      }

      function setOption() {
        console.log(this.name, this.value);
        msg[this.name] = this.value;
        toggle();
      }

      populateVoices();
      
      speechSynthesis.addEventListener('voiceschanged', populateVoices);
      voicesDropdown.addEventListener('change', setVoice);
      options.forEach(option => option.addEventListener('change', setOption));
      speakButton.addEventListener('click', toggle);
      stopButton.addEventListener('click', toggle.bind(null,false));


    </script>

  </main>
  <script type="text/javascript" src="src/index.js"></script>
</body>
</html>